stages:
- stage: Build_MobileAppApi_WebApi
  dependsOn: Test
  displayName: 'Publish build and push mobileapi.webapi stage'
  jobs:  
    - job: Build
      displayName: Publish Build Artifacts
      #pool:
      #  vmImage: 'windows-latest'
      steps:
        - task: UseDotNet@2
          displayName: 'Install .NET Core SDK'
          inputs:
            version: 3.1.x
        - task: DotNetCoreCLI@2
          displayName: 'dotnet publish'
          inputs:
            command: 'publish'
            projects: $(MobileAppApi.WebApi.ProjectsToBuildAndPublish)
            # Version suffix starts with build number and Append the current git hash to the version suffix
            arguments: '-o $(Build.ArtifactStagingDirectory)/$(MobileAppApi.WebApi.ArtifactSubDirectory) --no-self-contained --runtime $(runtime) --configuration $(buildConfiguration) --version-suffix $(Build.BuildNumber)-$(Build.SourceVersion)'
            # CIBG don't use ZIP files for artifacts
            zipAfterPublish: false
        - task: PublishBuildArtifacts@1
          inputs:
            PathtoPublish: '$(Build.ArtifactStagingDirectory)/$(MobileAppApi.WebApi.ArtifactSubDirectory)'
            ArtifactName: 'drop2'
            publishLocation: 'Container'